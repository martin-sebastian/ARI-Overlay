<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://cdnmedia.endeavorsuite.com/images/organizations/2f6fb18d-0219-47a3-8ba2-4a5123522365/inventory/11869925/SBI215-A23-GreyBlack-SCSC177-001.JPG"
    />
    <meta property="og:title" content="Vehicle Details" />
    <meta property="og:description" content="Check out this awesome vehicle!" />
    <meta property="og:url" content="https://newportal.flatoutmotorcycles.com/printapp/message.html?stockNumber=KW30286" />
    <title>Vehicle Details</title>
    <style>
      main {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      img {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        overflow: hidden;
      }
      .pre {
        white-space: pre-wrap;
        background: #eee;
        border: solid 1px #ddd;
        padding: 20px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <main>
      <div id="vehicle-details">
        <!-- Vehicle details will be populated here -->
      </div>
      <pre id="pre"></pre>
    </main>
    <script>
      // Function to get URL parameters
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // Fetch and populate vehicle details based on the stock number
      async function fetchVehicleDetails(stockNumber) {
        try {
          // Replace with your actual API endpoint to fetch vehicle details
          const apiUrl = `https://newportal.flatoutmotorcycles.com/portal/public/api/majorunit/stocknumber/${stockNumber}`;
          const response = await fetch(apiUrl);

          // Check if the response is ok
          if (!response.ok) {
            throw new Error(`Failed to fetch data: ${response.statusText}`);
          }

          // Parse the response data as JSON
          const data = await response.json();
          //console.log("Vehicle details:", data);

          // Assume the data contains fields: title, description, imageUrl, url, etc.
          const vehicleYear = data.ModelYear || "Year";
          const vehicleMake = data.Manufacturer || "Make";
          const vehicleModel = data.ModelName || "Model";
          const vehicleDescription = `Price: ${data.MSRP} <br> Stock Number: ${stockNumber}`;
          const vehicleCopy = `Price: ${data.MSRP} <br> Stock Number: ${stockNumber}`;
          const vehicleTitle = `${vehicleYear} ${vehicleMake} ${vehicleModel}`;
          const vehicleImageUrl = data.B50ImageUrl || "default-image.jpg";
          const vehiclePageUrl = data.Link || "https://www.flatoutmotorcycles.com";

          // Update Open Graph meta tags
          document.querySelector('meta[property="og:title"]').setAttribute("content", vehicleTitle);
          document.querySelector('meta[property="og:description"]').setAttribute("content", vehicleDescription);
          document.querySelector('meta[property="og:image"]').setAttribute("content", vehicleImageUrl);
          document.querySelector('meta[property="og:url"]').setAttribute("content", vehiclePageUrl);
          document.querySelector("title").innerText = `${vehicleTitle}`;

          // Update the page URL
          window.history.replaceState({}, "", `?stockNumber=${stockNumber}`);

          // Update the page content with vehicle details
          document.getElementById("vehicle-details").innerHTML = `
                  <img src="${vehicleImageUrl}" alt="${vehicleTitle}" style="max-width:100%; height:auto;">
                    <h1>${vehicleTitle}</h1>
                    <p>${vehicleDescription}</p>
                    <pre class="pre">
                      <svg style="float: right;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
                        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1z"/>
                        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0z"/>
                      </svg>

                      ${vehicleCopy}
                      </pre>

                `;
        } catch (error) {
          console.error("Error fetching vehicle details:", error);
          document.getElementById("vehicle-details").innerHTML = `<p>Error loading vehicle details. Please try again later.</p>`;
        }
      }

      // Get the stock number from the URL
      const stockNumber = getQueryParam("stockNumber");

      // Fetch and display the vehicle details if a stock number is provided
      if (stockNumber) {
        fetchVehicleDetails(stockNumber);
      } else {
        document.getElementById("vehicle-details").innerHTML = "<p>No stock number provided.</p>";
      }
    </script>
  </body>
</html>
